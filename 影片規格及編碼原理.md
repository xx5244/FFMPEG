# 影片規格及編碼原理
---

+ ## m3u8
  + ### 介紹
    M3U8檔案是指UTF-8編碼格式的M3U檔案，它的設計初衷是為了播放音訊檔，比如MP3，但是越來越多的軟體現在用來播放視訊檔列表，M3U也可以指定線上串流媒體音訊源，它是記錄了一個索引純文字檔案，開啟它時播放軟體並不是播放它，而是根據它的索引找到對應的音視訊檔案的網路地址進行線上播放
    &nbsp;
    M3U8是一種常見的流媒體格式，主要以檔案列表的形式存在，既支援直播又支援點播，尤其在Android、iOS等平臺最為常用
  + ### 格式
    1. EXTM3U：這個是M3U8檔案必須包含的標籤，並且必須在檔案的第一行，所有的M3U8檔案中必須包含這個標籤。
    2. EXT-X-VERSION：M3U8檔案的版本，常見的是3
    3. EXT-X-TARGETDURATION：該標籤指定了媒體檔案持續時間的最大值，播放檔案列表中的媒體檔案在EXTINF標籤中定義的持續時間必須小於或者等於該標籤指定的持續時間。該標籤在播放列表檔案中必須出現一次
    4. EXT-X-MEDIA-SEQUENCE：M3U8直播是的直播切換序列，當播放開啟M3U8時，以這個標籤的值作為參考，播放對應的序列號的切片
    5. EXTINF：EXTINF為M3U8列表中每一個分片的duration，如上面例子輸出資訊中的第一片的duration為10秒。在EXTINF標籤中，除了duration值，還可以包含可選的描述資訊，主要為標註切片資訊，使用逗號分隔開
    6. EXT-X-ENDLIST：若出現EXT-X-ENDLIST標籤，則表明M3U8檔案不會再產生更多的切片，可以理解為該M3U8已停止更新，並且播放分片到這個標籤後結束。M3U8不僅僅是可以作為直播，也可以作為點播存在，在M3U8檔案中儲存所有切片資訊最後使用EXT-X-ENDLIST結尾，這個M3U8即為點播M3U8。EXT-X-ENDLIST標籤可能會出現在播放列表檔案的任何地方，但是不能出現兩次或以上
    7. EXT-X-STREAM-INF：EXT-X-STREAM-INF標籤出現在M3U8時，主要是出現在多級M3U8檔案中時，例如M3U8中包含子M3U8列表，或者主M3U8中包含多位元速率M3U8時；該標籤後需要跟一些屬性
       1. BANDWIDTH：BANDWIDTH的值為最高位元速率值，當播放EXT-X-STREAM-INF下對應的M3U8時佔用的最大位元速率（必要引數）
       2. AVERAGE-BANDWIDTH：AVERAGE-BANDWIDTH的值為平均位元速率值，當播放EXT-X-STREAM-INF下對應的M3U8時佔用的平均位元速率。（可選引數）
       3. CODECS：CODECS的值用於宣告EXT-X-STREAM-INF下面對應M3U8裡面的音視訊編碼、視訊編碼的資訊（可選引數）
       4. RESOLUTION：M3U8中視訊的寬高資訊描述（可選引數）
       5. FRAME-RATE：子M3U8中的視訊幀率（可選引數）
  + ### 補充
    1. 分片必須是動態改變的，序列不能相同，並且序列必須是增序的
    2. 當M3U8沒有出現EXT-X-ENDLIST標籤時，無論這個M3U8列表中有多少分片，播放分片都是從倒數第三片開始播放，如果不滿三片則不應該播放。當然如果有些播放器做了特別定製了，則可以不遵照這個原則
    3. 以播放當前分片的duration時間重新整理M3U8列表，然後做對應的載入動作
    4. 前一片分片和後一片分片有不連續的時候，播放可能會出錯，那麼需要X-DISCONTINUTY標籤來解決這個錯誤
    5. 如果播放列表在重新整理之後與之前的列表相同，那麼在播放當前分片duration一半的時間內在重新整理一次

  + ### 參考資料
    [參考網站1](https://www.itread01.com/hkhkffpq.html)
    [參考網站2](https://zh.wikipedia.org/wiki/M3U)
